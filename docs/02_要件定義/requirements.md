# 要件定義書

## 1. プロジェクト概要
全国の市町村ごとの「都会度」を算出し、地図上で可視化するWebサービス「Urbanity Map（仮）」を構築する。
ユーザーは移住先検討や、自身の居住地の都会度確認、または単なるエンターテインメントとしてこれを利用する。

## 2. ターゲットユーザーとユースケース
- **移住検討者**: 「程よい都会」「生活に困らないレベルの田舎」など、自分に合った地域を探す。
- **一般ユーザー**: 自分の住んでいる街や出身地の都会度を見て楽しむ。SNSでシェアする。
- **データ愛好家**: 都市構造や地理データに興味がある層。

## 3. 「都会度」の定義とモデル化
行政区域（市町村）ごとに1つの「都会度スコア」を算出する。
調査結果（`docs/01_調査/都会度モデル化手法の結論.md`）に基づき、**「3層ハイブリッドモデル」**を採用する。

### 3.1 採用する指標（3層モデル）
以下の3層を組み合わせ、多角的に都会度をスコア化する。

| 層 | 指標 | 役割 | データソース |
|----|------|------|-------------|
| **① ベース層（活動量）** | 夜間光データ (VIIRS) | 都市の「規模・エネルギー」を測定 | 衛星観測データ |
| **② 居住層（定住量）** | 500m人口メッシュ | 都市の「住人の厚み」を測定 | 国土数値情報 |
| **③ 機能層（利便性）** | 店舗POI密度 | 都市の「便利さ」を測定 | OpenStreetMap等 |

#### 機能層の詳細（旧要件を統合）
- **コンビニエンスストア密度**: 24時間の活動強度、利便性の指標。
- **スーパーマーケット密度**: 定住生活の基盤、生活維持機能の指標。
- **飲食店密度**: 文化的・社会的活動、夜間経済の指標。

### 3.2 算出ロジックの概要
1. **ベース層**: 市町村ポリゴン内の平均夜間光輝度をZonal Statisticsで算出。
2. **居住層**: 500mメッシュのうち高密度（DID相当）の割合を算出。
3. **機能層**: 各店舗カテゴリの密度または距離減衰スコア（Walk Score方式）を算出。
4. 各層を0-100に正規化し、重み付け合算して総合「都会度スコア」とする。

### 3.3 プロトタイプ戦略
まずは**夜間光データ（ベース層）のみ**を実装し、技術検証（PoC）を行う。
その後、人口・POIデータを段階的に追加し、3層モデルを完成させる。

## 4. 機能要件

### 4.1 ユーザーインターフェース (UI)
- **日本地図表示**: 全国を俯瞰でき、ズーム操作が可能。
- **色分け表示**: 市町村のポリゴンを都会度スコアに応じて色分け（例：ヒートマップカラー）。
- **詳細情報表示**:
    - 市町村をクリック/タップすると、詳細モーダルまたはサイドパネルが開く。
    - 総合スコア、各構成要素（コンビニ度、スーパー度など）のスコアを表示。
- **検索機能**: 市町村名で検索し、該当箇所へズームおよびハイライト。

### 4.2 システム要件
- **静的サイト生成 (SSG)**: サーバーサイドで動的に計算するのではなく、事前に計算済みのGeoJSON/タイルデータを配信する。
- **更新頻度**: 1ヶ月〜1年に1回程度。バッチ処理でデータを更新し、デプロイする運用。

## 5. 非機能要件
- **パフォーマンス**: 大量のポリゴンデータを扱うため、レンダリング速度（MVT: Mapbox Vector Tilesの使用など）に配慮する。
- **デバイス対応**: PCおよびスマートフォンで閲覧可能であること。

## 6. 技術スタック案
- **フロントエンド**: React, TypeScript, MapLibre GL JS (または Leaflet)
- **データ処理**: Python (Pandas, GeoPandas)
- **ホスティング**: GitHub Pages, Vercel, or AWS S3 + CloudFront
- **地図データ**: OpenStreetMap, 国土数値情報
