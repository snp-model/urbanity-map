# Urbanity Map

全国市町村の「都会度」と「光害」を可視化するインタラクティブマップアプリケーション。

## 概要

Urbanity Map は、日本全国の市町村ごとに「都会度」と「光害」のスコアを算出し、地図上で視覚的に表示する Web アプリケーションです。移住検討者や一般ユーザーが、各地域の都市機能の充実度や夜空の見やすさを直感的に把握できます。

## 主な機能

- 🏙️ **都会度表示**: 夜間光・人口・POI・地価の 4 層統合スコアによる都市機能の可視化
- ⭐ **光害表示**: 夜間光データによる光害レベルの可視化（星空の見やすさ）
- 📊 **統計データ**: 平均所得・人口増加率・高齢者割合・地価などの表示
- 🗾 **全国対応**: 日本全国の市区町村（約 1,900 自治体）をカバーし、県境も表示
- 🎨 **動的カラーリング**: モードに応じた直感的な色分け表示（対数スケール対応）
- 📊 **詳細情報**: 市区町村をクリックしてスコア詳細や統計値を一覧表示

## プロジェクト構成

```
urbanity-map/
├── docs/                    # ドキュメント
│   ├── 01_調査/             # 調査資料
│   ├── 02_要件定義/         # 要件定義書・ADR
│   ├── 03_設計/             # システム設計書
│   └── DATA_PREPARATION.md  # データ準備ガイド
├── frontend/                # フロントエンドアプリケーション (React + Vite)
│   └── public/data/         # 処理済みデータ（Gitに含まれる、約13MB）
├── scripts/                 # データ処理スクリプト (Python)
├── data/                    # ソースデータ（Gitに含まれない、約5.9GB）
└── README.md
```

## 技術スタック

### フロントエンド

- **React 18**: UI ライブラリ
- **TypeScript**: 型安全性
- **Vite**: 高速ビルドツール
- **MapLibre GL JS**: オープンソース地図ライブラリ
- **Vanilla CSS**: スタイリング

### データ処理

- **Python 3.11+**: データ処理言語
- **uv**: Python パッケージマネージャー
- **GeoPandas**: 地理空間データ処理
- **Rasterio**: ラスターデータ処理

### データソース

- **国土地理院**: 地図タイル、市区町村境界データ
- **VIIRS**: 夜間光データ
- **e-Stat**: 国勢調査データ（人口、年齢別人口、人口増減率）、課税所得データ、人口メッシュデータ（予備）
- **国土数値情報**: 地価公示データ
- **OpenStreetMap**: POI（施設）データ

## クイックスタート

### フロントエンドの起動

```bash
# フロントエンドのセットアップ
cd frontend
npm install
npm run dev
```

ブラウザで http://localhost:5173 を開いてください。

### データの準備（初回のみ）

処理済みデータは Git リポジトリに含まれているため、通常は不要です。
データを再生成する場合は、[データ準備ガイド](docs/DATA_PREPARATION.md)を参照してください。

## データ管理

### Git に含まれるデータ（約 13MB）

- `frontend/public/data/` - 処理済みデータ（アプリケーション実行に必須）
  - `japan-with-scores-v2.geojson` - スコア付き市区町村境界
  - `urbanity-score-v2.json` - 統合スコア JSON
  - `prefectures.geojson` - 県境データ
  - その他のスコア・統計データファイル

### Git から除外されるデータ（約 5.9GB）

- `data/` - ソースデータ（再ダウンロード・再生成可能）
  - OpenStreetMap データ
  - 夜間光データ
  - 市区町村境界データ
  - 人口メッシュデータ（現在は統計値表示の補完用）

## ドキュメント

| ドキュメント                                                                  | 説明                           |
| ----------------------------------------------------------------------------- | ------------------------------ |
| [データ準備ガイド](docs/DATA_PREPARATION.md)                                  | データのダウンロードと処理手順 |
| [フロントエンド README](frontend/README.md)                                   | フロントエンドの詳細情報       |
| [スクリプト README](scripts/README.md)                                        | データ処理スクリプトの詳細     |
| [要件定義書](docs/02_要件定義/requirements.md)                                | プロジェクトの要件定義         |
| [システム設計書](docs/03_設計/system_design.md)                               | システムアーキテクチャ         |
| [ADR-001: タイルサーバー選定](docs/02_要件定義/ADR/001_タイルサーバー選定.md) | タイルサーバーの選定理由       |

## スコアの算出方法

### 都会度スコア

4 層のデータを用いた主成分分析（PCA）により算出：

- **入力**: 夜間光・人口（国勢調査）・POI・地価
- **プロセス**:
  1. 各変数に対数変換 `log(x + 1)` を適用（分布の適正化）
  2. PCA を実行し、第一主成分（データのばらつきを最も説明する軸）を抽出
  3. 0-100 に正規化してスコア化
- **重み**: 夜間光:0.26, 人口:0.23, POI:0.26, 地価:0.24
- **目的**: 大都市へのスコア集中を防ぎ、地方都市の差も可視化できる客観的な指標を実現

### 光害スコア

夜間光データをそのまま使用（0-100 で正規化）

詳細は [URBANITY_ALGORITHM.md](docs/URBANITY_ALGORITHM.md) を参照してください。

## データ出典

本アプリケーションでは、以下のオープンデータを使用・加工しています。

- **気象庁**: [過去の気象データ・ダウンロード](https://www.data.jma.go.jp/gmd/risk/obsdl/index.php) （月最高気温、月最深積雪）
  - 本アプリケーションの気象情報は、気象庁のデータを加工して作成したものです。
- **国土交通省**: [国土数値情報（行政区域データ）](https://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-N03-v3_1.html)
- **総務省統計局**: [国勢調査](https://www.stat.go.jp/data/kokusei/2020/index.html) （人口等）
- **総務省**: [市町村税課税状況等の調](https://www.soumu.go.jp/main_sosiki/jichi_zeisei/czaisei/czaisei_seido/ichiran09_18.html) （課税対象所得）
- **国土交通省**: [地価公示](https://www.mlit.go.jp/totikensangyo/totikensangyo_fr4_000043.html)

## ライセンス

MIT License
